### 자,시작해보자!

코드를 수정하기 위해선 사람의 개입이 필요하기 때문에 코드의 미적 상태와 수정 가능한 시스템을 만드는 것을 코드를 작성할 때 부터 고려해야한다.
즉 기능을 추가하기 쉬운 형태로 리팩터링 하고 나서 원하는 기능을 추가하는 형태가 바람직하다.

### 1-2 예시 프로그램을 본 소감

잘 작동하고 변경될 일이 없는 코드라면 코드를 현재 상태로 놔둬도 되지만 다른사람이 읽고 이해해야 할 일이 생겼는데 로직을 파악하기 어렵다면 대책을 마련해야 한다.

### 1-3 리팩터링의 첫 단계

리팩터링 하기 전에 제대로 된 테스트 부터 마련해야 한다.
실제 리팩터링 작업과 수정 작업은 사람이 하기 때문에 언제든 실수할 수 있는 여지가 있다.
테스트는 내가 만든 실수로부터 코드를 보호하는 버그 검출기이다.

이러한 테스트는 속도와 정확도를 위해 "자가진단"의 형태를 띄도록 구성해야한다.

위 코드의 함수는 문자열을 반환하므로 여러 장르로 구성된 공연들로 청구서들을 미리 작성해서 문자열 형태로 작성해둔다. (즉 여러 input에 대해 동일한 output을 보장하는지를 테스트ㅌ)

### 1-4 statement()함수 쪼개기

코드를 분석해서 얻은 정보를 머릿속으로 기억하면 잊혀진다.
때문에 잊지 않으려면 빠르게 코드에 반영해야한다. 코드에 반영하면 다시 분석하지 않더라도 코드가 어떤 일을 하는지 파악하기가 쉬워진다.

또한 리팩터링은 프로그램 수정을 작은 단계로 나누어서 진행한다.
왜냐면 리팩터링 중간에 실수하더라도 버그를 쉽게 찾고 일찍 찾기 위해서이다.
즉 조금씩 수정하고 피드백 주기를 짧게 가져가는 습관이 작업하는데에 좋다.
커밋 또한 짧은 주기로 해야 이상이 생겼을 때 이전 지점으로 되돌아갈 수 있다.

또한 중첩함수를 이용하게 되면 바깥함수에서 쓰던 변수를 새로 추출한 함수에 매개변수로 전달할 필요가 없어서 편하다.

변수의 역할을 쉽게 알 수 있는 변수명이 좋다.
때문에 저자는 함수의 반환값에는 항상 return이라는 변수명을 사용한다.

때문에 접두어로 타입이름을 적는 것을 선호한다. 타입과 변수의 역할을 동시에 알 수 있다. 역할이 애매모호할 경우에는 부정관사(a/an)을 붙인다.

긴 함수를 잘게 쪼겔 때 임시변수들을 최대한 줄인다. 로컬범위에 존재하는 이름이 늘어나서 추출작업이 복잡해지기 때문이다.
이를 질의함수로 변경하여 해결한다. 즉 로컬변수를 함수 스코프에서 사용 가능한 함수로 변경해서 로컬 유효범위의 변수의 개수를 줄이는 전략이다.

### 1-6 계산 단계와 포맷팅 단계 분리하기

하나의 함수가 하나의 역할을 할 수 있게끔 로직을 단계별로 나누는 것도 중요하다.
위의 함수에서 html로 표현할 수 있는 함수를 만들려고 할 때 중첩된 함수를 모두 복사해서 새로운 관리포인트를 만들지 않으려면 로직을 단계별로 나누어 분리할 수 있다.

즉 기존에 데이터를 만들며 텍스트로 표현하는 함수를 데이터를 만들고(1) 텍스트나 html로 표현(2) 하는 방식으로 나누었다.

즉 중간데이터 구조를 생성하는 것이다.

중간 데이터를 생성하기 위해선 가변성과 불변성을 잘 고려해야 한다.
자바스크립트는 동적언어이기 때문에 가변데이터는 안정성을 보장하지 못한다.
떄문에 데이터를 가공하는 함수는 불변성을 지킬 수 있도록, 데이터를 복사해서 새로운 객체를 반환하도록 불변으로 취급한다.

### 1-7 중간 점검: 두 파일(과 두 단계)로 분리됨

리팩터링을 하게 되면 새로운 함수로 분리하며 코드 길이가 길어지게 된다.
하지만 코드가 모듈화되어 각 부분이 하는 일과 전체적인 로직을 파악하기 쉽게 된다.

### 1-8 다형성을 활용해 계산 코드 재구성하기

여러 장르가 추가되고 장르에 따라 계산방법을 다르게 해야할 때 호출하는 쪽에서는 복잡한 계산 로직에 대해 알 필요가 없다.
이런 상황엔 상속계층을 구성해서 각자가 구체적인 계산로직을 정의하도록 할 수 있다.
즉 데이터를 계산하는 영역을 분리해서 호출하는 쪽으로부터 추상화하는 것이다.

다형성을 활용하기 위해선 타입코드를 서브클래스로 바꾸어야한다.
즉 공연계산 이라는 타입을 희극공연 계산, 비극 공연 계산 각각을 서브클래스로 만들고, 팩토리함수로 적절한 서브클래스를 사용할 수 있도록 하면, 서브클래스 별로 계산 로직을 추상화하여 분리할 수 있다.

### 1-9 상태 점검: 다형성을 활용하여 데이터 생성하기

수정하며 연극별 계산 코드들을 하나로 묶어서 새롭게 추가하거나 수정하기 쉬운 설계를 할 수 있게 됐다. 새로운 서브클래스를 작성하고 팩토리패턴에 추가하면 된다.

서브클래스는 같은 타입의 다형성을 기반으로 실행되는 함수가 많을수록 사용하여 이렇게 구성하는 것이 유리하다.

다른 구현방식으로는 createStatementData가 계산기 자체를 반환하도록 구현해도 된다.
게터 메소드를 호출하는 코드와 일반적인 데이터 접근 코드의 모양이 같기 때문에 가능한 구현사항이다.

### 1-10 마치며

1. 원본 함수를 중첩함수 여러개로 나누었다.
2. 단위 쪼개기를 사용해서 계산 코드와 출력 코드를 분리했다.
3. 서브클래스와 팩토리 함수를 사용해서 계산 로직을 다형성으로 표현했다.

코드가 하는 일이 더욱 분명하게 드러나게 됐다.

수정하기 쉬운 코드로 수정하였다.
